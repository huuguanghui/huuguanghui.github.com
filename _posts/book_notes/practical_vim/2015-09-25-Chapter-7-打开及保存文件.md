---
layout: default
title: 第七章 打开及保存文件
---
# Practical Vim

## Edit Text at the Speed of Thought

## 第七章 打开及保存文件

* 技巧41：用`:edit`命令打开文件

    在Vim中，`:edit`命令允许通过文件的绝对路径或者相对路径来打开文件。在Vim启动时，它会采用shell的活动目录作为其当前目录，可以通过`:pwd`命令查看当前目录。
    
    **相对于活动文件目录打开一个文件**
    
    假设Vim的当前活动目录是aa，我们正在编辑文件aa/bb/file1.txt。如果想编辑文件aa/bb/file2.txt，可以直接在命令模式下输入`:edit aa/bb/file2.txt`。这种方法需要输入完整的文件路径，比较麻烦。
    
    我们可以先尝试命令`:edit %<Tab>`。
    `%`代表当前文件的完整路径，`<Tab>`键会将其展开，显示完整的文件路径。在该例子中，展示为：bb/file1.txt。
    
    我们再尝试一条命令`:edit %:h<Tab>`。
    修饰符`:h`会去掉文件名，只保留目录信息。在此例中，以上命令会被展开为`:edit bb/`。这时候再输入要打开的文件名file2.txt即可。

* 技巧42：用`:find`打开文件

`:find`命令允许我们通过文件名打开一个文件，但无需输入该文件的完整路径。

然而`:find`默认只在当前目录下寻找文件，我们可以通过设置`path`选项来扩展`:find`的查询范围。

`:set path+=./**`把当前目录下所有子目录添加到了`path`中，这样`:find`就可以在子目录中进行查找。

* 技巧43：使用`netrw`管理文件系统

除了查看和编辑文件内容，Vim自带的插件`netrw`还允许我们查看目录，对文件系统进行管理。

**启用netrw**

在vimrc中添加下面几行配置
```
essential.vim
set nocompatiable
filetype plugin on
```
如果使用一个指向目录的路径启动Vim的话，Vim就会打开一个文件管理器窗口。

也可以使用`:edit {path}`打开文件管理器窗口，只要把{path}设为目录名就行。

可以使用命令`:edit %:h`在文件管理器中打开当前文件所在目录。
另外，`netrw`插件提供了一个更为方便的命令`:Explore`来完成这个操作。

Ex命令|缩写|用途
------|----|----
:edit .|:e.|打开文件管理器并显示当前工作目录
:Explore|:E|打开文件管理器并显示活动缓冲区所在目录

除了`:Explore`之外，Vim还提供了`:Vexplore`和`:Sexplore`，分别用于在垂直切分窗口和水平切分窗口中打开文件管理器。

* 技巧44：把文件保存到不存在的目录中

即使缓冲区的路径中包含了不存在的目录，Vim仍允许我们对该缓冲区进行编辑，只是在我们试图将缓冲区写入文件时会报错。

`:edit {file}`命令一般用于打开一个已存在的文件，如果我们指定了一个不存在的文件路径，Vim就会创建一个新的空白缓冲区。当我们执行`:write`命令时，Vim就会尝试把该缓冲区内容写到创建该缓冲区时候指定的路径中。

如果执行`:edit {file}`时指定的文件路径中包含了不存在的目录，Vim无法完成保存。这时候需要调用外部命令`mkdir`创建不存在的目录：
`:!mkdir -p %h`
`:write`
`-p`参数使mkdir创建任何不存在的中间目录。

* 技巧45：以超级用户权限保存文件



